<script type="text/javascript">
    RED.nodes.registerType('flujo-estandar', {
        category: 'function',
        color: '#C7E9C0',
        defaults: {
            name: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-calculator",
        label: function() {
            return this.name || "Flujo Estándar LPG";
        },
        paletteLabel: "Flujo Estándar"
    });
</script>

<script type="text/html" data-template-name="flujo-estandar">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Nombre</label>
        <input type="text" id="node-input-name" placeholder="Nombre">
    </div>
</script>

<script type="text/html" data-help-name="flujo-estandar">
    <p>Convierte flujo másico (kg/h) a flujo volumétrico estándar (a 60°F) para LPG (butano/propano).</p>
    <p>Aplica correcciones por temperatura (Ctl) y presión (Cpl) según API MPMS 11.2.2 y GPA TP-27.</p>

    <h3>Entrada</h3>
    <p><code>msg.payload</code> debe contener un objeto con:</p>
    <ul>
        <li><code>massFlow</code> - Flujo másico en kg/h (del medidor Coriolis)</li>
        <li><code>fluid</code> - Tipo de fluido: 'butano', 'propano', o 'lpg'</li>
        <li><code>observedTempF</code> - Temperatura observada en °F</li>
        <li><code>observedPressurePSI</code> - Presión observada en PSIG</li>
        <li><code>observedDensity</code> - Densidad observada en kg/m³ (del Coriolis)</li>
        <li><code>rvp</code> - (Opcional) Reid Vapor Pressure en PSI @ 100°F del laboratorio</li>
        <li><code>mFactor</code> - (Opcional) Factor de corrección del medidor (default: 1.0)</li>
    </ul>

    <h3>Salida</h3>
    <p><code>msg.payload</code> contendrá:</p>
    <ul>
        <li><code>m3_h</code>, <code>lt_h</code>, <code>bbl_d</code>, <code>gal_h</code> - Flujo volumétrico estándar (GSV)</li>
        <li><code>volumes</code> - IV (indicado), GUV (bruto), GSV (estándar) en US gal</li>
        <li><code>gross</code> - Flujo volumétrico bruto (GUV)</li>
        <li><code>corrections</code> - Factores Ctl, Cpl, CCF, mFactor, Pe, ΔP</li>
        <li><code>input</code> - Datos de entrada incluyendo densidad en SG</li>
    </ul>

    <h3>Ejemplo de entrada</h3>
    <pre>
msg.payload = {
    massFlow: 18580.72,        // kg/h
    fluid: "propano",
    observedTempF: 84.75,      // °F
    observedPressurePSI: 195.54, // PSIG
    observedDensity: 481.8,    // kg/m³ (0.4823 SG)
    rvp: 180,                  // PSI @ 100°F
    mFactor: 1.0010            // Factor del medidor
};
    </pre>

    <h3>Fórmulas</h3>
    <ul>
        <li><b>IV</b> (Indicado) = Masa / Densidad Observada</li>
        <li><b>GUV</b> (Bruto) = IV × M-Factor</li>
        <li><b>GSV</b> (Estándar) = GUV × CCF</li>
        <li><b>CCF</b> = Ctl × Cpl</li>
    </ul>

    <h3>Notas</h3>
    <ul>
        <li>Si proporciona el <b>RVP</b> del laboratorio, se usará para calcular Pe con mayor precisión</li>
        <li>El <b>M-Factor</b> es el factor de calibración del medidor Coriolis</li>
        <li>La <b>densidad observada</b> debe ser la medida por el Coriolis, no la estándar</li>
    </ul>
</script>
